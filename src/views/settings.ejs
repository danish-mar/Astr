<div x-data="settingsData" x-init="init()" class="min-h-screen bg-[#f9fafb] pb-20">
    <!-- Premium Header -->
    <div class="bg-white/70 backdrop-blur-xl border-b border-gray-100 mb-12">
        <div class="max-w-[1400px] mx-auto px-8 py-10">
            <h1 class="text-4xl font-bold text-gray-900 tracking-tight mb-2">Settings</h1>
            <p class="text-gray-400 text-lg font-medium">Manage your shop configuration and team.</p>
        </div>
    </div>

    <div class="max-w-[1400px] mx-auto px-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
            <!-- Refined Sidebar -->
            <div class="lg:col-span-3">
                <nav class="sticky top-32 space-y-2 animate__animated animate__fadeInLeft">
                    <button @click="activeTab = 'general'"
                        class="w-full flex items-center gap-4 px-6 py-4 rounded-[24px] transition-all duration-300 group"
                        :class="activeTab === 'general' ? 'bg-gray-900 text-white shadow-xl shadow-gray-200' : 'text-gray-400 hover:bg-gray-50 hover:text-gray-900'">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center transition-colors"
                            :class="activeTab === 'general' ? 'bg-white/10 text-white' : 'bg-gray-100 text-gray-400 group-hover:bg-white'">
                            <i class="fas fa-sliders-h text-xs"></i>
                        </div>
                        <span class="text-[11px] font-bold uppercase tracking-widest">General</span>
                    </button>

                    <button @click="activeTab = 'users'"
                        class="w-full flex items-center gap-4 px-6 py-4 rounded-[24px] transition-all duration-300 group"
                        :class="activeTab === 'users' ? 'bg-gray-900 text-white shadow-xl shadow-gray-200' : 'text-gray-400 hover:bg-gray-50 hover:text-gray-900'">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center transition-colors"
                            :class="activeTab === 'users' ? 'bg-white/10 text-white' : 'bg-gray-100 text-gray-400 group-hover:bg-white'">
                            <i class="fas fa-users-cog text-xs"></i>
                        </div>
                        <span class="text-[11px] font-bold uppercase tracking-widest">Team</span>
                    </button>

                    <button @click="activeTab = 'ai'"
                        class="w-full flex items-center gap-4 px-6 py-4 rounded-[24px] transition-all duration-300 group"
                        :class="activeTab === 'ai' ? 'bg-gray-900 text-white shadow-xl shadow-gray-200' : 'text-gray-400 hover:bg-gray-50 hover:text-gray-900'">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center transition-colors"
                            :class="activeTab === 'ai' ? 'bg-white/10 text-white' : 'bg-gray-100 text-gray-400 group-hover:bg-white'">
                            <i class="fas fa-robot text-xs"></i>
                        </div>
                        <span class="text-[11px] font-bold uppercase tracking-widest">AI Settings</span>
                    </button>
                </nav>
            </div>

            <!-- Content Canvas -->
            <div class="lg:col-span-9">
                <!-- General Section -->
                <div x-show="activeTab === 'general'" x-transition class="space-y-8">
                    <div
                        class="bg-white border border-gray-100 rounded-[40px] p-10 shadow-sm animate__animated animate__fadeInUp">
                        <div class="flex items-center justify-between mb-12">
                            <div>
                                <h3 class="text-2xl font-bold text-gray-900 tracking-tight">Shop Identity</h3>
                                <p class="text-gray-400 font-medium text-sm mt-1">Manage your shop name, contact info,
                                    and
                                    branding.</p>
                            </div>
                            <div
                                class="w-14 h-14 bg-gray-900 rounded-[22px] flex items-center justify-center text-white shadow-xl shadow-gray-200">
                                <i class="fas fa-store text-lg"></i>
                            </div>
                        </div>

                        <form @submit.prevent="saveSettings()" class="space-y-10">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="space-y-3">
                                    <label
                                        class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">Shop
                                        Name</label>
                                    <input type="text" x-model="settings.shopName" required
                                        class="block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-[22px] text-gray-900 font-bold focus:ring-4 focus:ring-blue-50 focus:bg-white focus:border-blue-200 outline-none transition-all">
                                </div>

                                <div class="space-y-3">
                                    <label
                                        class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">Theme
                                        Color</label>
                                    <div
                                        class="flex items-center gap-4 bg-gray-50 p-2 rounded-[22px] border border-gray-100">
                                        <input type="color" x-model="settings.themeColor"
                                            class="h-12 w-20 rounded-2xl border-none cursor-pointer bg-transparent">
                                        <span
                                            class="text-[11px] font-bold text-gray-900 font-mono tracking-widest uppercase"
                                            x-text="settings.themeColor"></span>
                                    </div>
                                </div>

                                <div class="space-y-3">
                                    <label
                                        class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">Phone
                                        Number</label>
                                    <input type="tel" x-model="settings.phone"
                                        class="block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-[22px] text-gray-900 font-bold focus:ring-4 focus:ring-blue-50 focus:bg-white focus:border-blue-200 outline-none transition-all">
                                </div>

                                <div class="space-y-3">
                                    <label
                                        class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">Email
                                        Address</label>
                                    <input type="email" x-model="settings.email"
                                        class="block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-[22px] text-gray-900 font-bold focus:ring-4 focus:ring-blue-50 focus:bg-white focus:border-blue-200 outline-none transition-all">
                                </div>

                                <div class="md:col-span-2 space-y-3">
                                    <label
                                        class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">Address</label>
                                    <textarea x-model="settings.address" rows="4"
                                        class="block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-[22px] text-gray-900 font-bold focus:ring-4 focus:ring-blue-50 focus:bg-white focus:border-blue-200 outline-none transition-all resize-none"></textarea>
                                </div>
                            </div>

                            <div class="flex justify-end pt-8 border-t border-gray-50">
                                <button type="submit" :disabled="saving"
                                    class="px-10 py-5 bg-gray-900 text-white rounded-[24px] text-[11px] font-bold uppercase tracking-[0.2em] shadow-2xl shadow-gray-200 hover:bg-black active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-4">
                                    <i :class="saving ? 'fas fa-spinner fa-spin' : 'fas fa-check'" class="text-xs"></i>
                                    <span x-text="saving ? 'Saving...' : 'Save Settings'"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>


                <!-- AI Intelligence Section -->
                <div x-show="activeTab === 'ai'" x-transition class="space-y-8">
                    <div
                        class="bg-white border border-gray-100 rounded-[40px] p-10 shadow-sm animate__animated animate__fadeInUp">
                        <div class="flex items-center justify-between mb-12">
                            <div>
                                <h3 class="text-2xl font-bold text-gray-900 tracking-tight">AI Configuration</h3>
                                <p class="text-gray-400 font-medium text-sm mt-1">Enable and configure AI features for
                                    content generation.</p>
                            </div>
                            <div
                                class="w-14 h-14 bg-purple-900 rounded-[22px] flex items-center justify-center text-white shadow-xl shadow-purple-200">
                                <i class="fas fa-bolt text-lg"></i>
                            </div>
                        </div>

                        <form @submit.prevent="saveSettings()" class="space-y-10">
                            <div
                                class="flex items-center justify-between p-8 bg-purple-50/50 rounded-[32px] border border-purple-100/50">
                                <div>
                                    <h4 class="text-sm font-bold text-purple-900 uppercase tracking-[0.2em]">Enable AI
                                        Features</h4>
                                    <p class="text-[11px] font-bold text-purple-700/60 mt-2">Use AI to help write
                                        product
                                        descriptions and analyze data.</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer scale-110">
                                    <input type="checkbox" x-model="settings.aiEnabled" class="sr-only peer">
                                    <div
                                        class="w-16 h-8 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-purple-600">
                                    </div>
                                </label>
                            </div>

                            <div class="grid grid-cols-1 gap-8" x-show="settings.aiEnabled">
                                <div class="space-y-3">
                                    <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">AI
                                        Provider</label>
                                    <select x-model="settings.aiProvider"
                                        class="block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-[22px] text-gray-900 font-bold focus:ring-4 focus:ring-purple-50 focus:bg-white focus:border-purple-200 outline-none transition-all appearance-none cursor-pointer">
                                        <option value="none">Deactivated</option>
                                        <option value="gemini">Google Gemini Ultra (Efficient Synth)</option>
                                        <option value="openai">OpenAI GPT-4o (Extreme Precision)</option>
                                    </select>
                                </div>

                                <div class="space-y-3" x-show="settings.aiProvider !== 'none'">
                                    <label
                                        class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">API
                                        Key</label>
                                    <div class="relative">
                                        <input :type="showApiKey ? 'text' : 'password'" x-model="settings.aiApiKey"
                                            placeholder="••••••••••••••••••••••••••••••"
                                            class="block w-full px-6 py-4 pr-16 bg-gray-50 border border-gray-100 rounded-[22px] text-gray-900 font-bold focus:ring-4 focus:ring-purple-50 focus:bg-white focus:border-purple-200 outline-none transition-all">
                                        <button type="button" @click="showApiKey = !showApiKey"
                                            class="absolute right-6 top-1/2 -translate-y-1/2 text-gray-300 hover:text-purple-600 transition-colors">
                                            <i :class="showApiKey ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                                        </button>
                                    </div>

                                    <div class="mt-4 p-6 bg-gray-50 border border-gray-100 rounded-[24px]">
                                        <div class="flex items-center gap-3 mb-3">
                                            <i class="fas fa-lightbulb text-amber-500 text-xs"></i>
                                            <span
                                                class="text-[10px] font-bold text-gray-900 uppercase tracking-widest">Setup
                                                Guide</span>
                                        </div>
                                        <p class="text-[11px] font-bold text-gray-400 leading-relaxed"
                                            x-show="settings.aiProvider === 'gemini'">Generate your cryptographic key at
                                            the <a href="https://makersuite.google.com/app/apikey" target="_blank"
                                                class="text-purple-600 underline">Google Cloud Portal</a>. Gemini
                                            provides high-volume free tier processing.</p>
                                        <p class="text-[11px] font-bold text-gray-400 leading-relaxed"
                                            x-show="settings.aiProvider === 'openai'">Retrieve your production keys from
                                            the <a href="https://platform.openai.com/api-keys" target="_blank"
                                                class="text-purple-600 underline">OpenAI Dashboard</a>. Ensure your
                                            billing tier supports GPT-4o access.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="flex items-center justify-between pt-8 border-t border-gray-50"
                                x-show="settings.aiProvider !== 'none' && settings.aiApiKey">
                                <button type="button" @click="testAIConnection()" :disabled="testingConnection"
                                    class="px-8 py-5 bg-gray-50 text-[11px] font-bold uppercase tracking-[0.2em] text-gray-600 rounded-[22px] hover:bg-gray-100 transition-all flex items-center gap-3">
                                    <i
                                        :class="testingConnection ? 'fas fa-spinner fa-spin text-purple-500' : 'fas fa-plug'"></i>
                                    <span x-text="testingConnection ? 'Testing...' : 'Test Connection'"></span>
                                </button>

                                <div x-show="connectionTestResult"
                                    class="flex items-center gap-3 animate__animated animate__fadeIn">
                                    <div class="w-2 h-2 rounded-full"
                                        :class="connectionTestSuccess ? 'bg-green-500' : 'bg-red-500'"></div>
                                    <span class="text-[10px] font-bold uppercase tracking-widest"
                                        :class="connectionTestSuccess ? 'text-green-600' : 'text-red-600'"
                                        x-text="connectionTestMessage"></span>
                                </div>
                            </div>

                            <div class="flex justify-end pt-4 border-t border-gray-50">
                                <button type="submit" :disabled="saving"
                                    class="px-10 py-5 bg-purple-900 text-white rounded-[24px] text-[11px] font-bold uppercase tracking-[0.2em] shadow-2xl shadow-purple-100 hover:bg-purple-950 active:scale-95 transition-all disabled:opacity-50 flex items-center gap-4">
                                    <i :class="saving ? 'fas fa-spinner fa-spin' : 'fas fa-save'" class="text-xs"></i>
                                    <span x-text="saving ? 'Saving...' : 'Save AI Settings'"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Redesigned User Modal -->
        <div x-show="showUserModal" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            class="fixed inset-0 bg-gray-900/40 backdrop-blur-xl z-[60] flex items-center justify-center p-4"
            @click.self="closeUserModal()" style="display: none;">

            <div x-show="showUserModal" x-transition:enter="transition ease-out duration-500 transform"
                x-transition:enter-start="opacity-0 translate-y-8 scale-95"
                x-transition:enter-end="opacity-100 translate-y-0 scale-100"
                class="bg-white rounded-[40px] shadow-2xl max-w-lg w-full overflow-hidden animate__animated animate__zoomIn">

                <div class="p-10">
                    <div class="flex items-center justify-between mb-10">
                        <h3 class="text-3xl font-bold text-gray-900 tracking-tighter"
                            x-text="editMode ? 'Edit User' : 'Add User'"></h3>
                        <button @click="closeUserModal()"
                            class="w-10 h-10 bg-gray-50 text-gray-400 rounded-full flex items-center justify-center hover:text-gray-900 transition-colors">
                            <i class="fas fa-times text-sm"></i>
                        </button>
                    </div>

                    <form @submit.prevent="saveUser()" class="space-y-8">
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">Full
                                Name</label>
                            <input type="text" x-model="userForm.name" required
                                class="block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-[22px] text-gray-900 font-bold focus:ring-4 focus:ring-blue-50 focus:bg-white focus:border-blue-200 outline-none transition-all">
                        </div>

                        <div class="space-y-2">
                            <label
                                class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">Username</label>
                            <input type="text" x-model="userForm.username" required :disabled="editMode"
                                class="block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-[22px] text-gray-900 font-bold focus:ring-4 focus:ring-blue-50 focus:bg-white focus:border-blue-200 outline-none transition-all disabled:opacity-50">
                        </div>

                        <div x-show="!editMode" class="space-y-2">
                            <label
                                class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">Password</label>
                            <input type="password" x-model="userForm.password" :required="!editMode"
                                class="block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-[22px] text-gray-900 font-bold focus:ring-4 focus:ring-blue-50 focus:bg-white focus:border-blue-200 outline-none transition-all">
                        </div>

                        <div class="space-y-2">
                            <label
                                class="text-[10px] font-bold text-gray-400 uppercase tracking-widest ml-1">Role</label>
                            <select x-model="userForm.position" required
                                class="block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-[22px] text-gray-900 font-bold focus:ring-4 focus:ring-blue-50 focus:bg-white focus:border-blue-200 outline-none transition-all cursor-pointer">
                                <option value="Staff">Staff</option>
                                <option value="Technician">Technician</option>
                                <option value="Sales">Sales</option>
                                <option value="Manager">Manager</option>
                                <option value="Admin">Administrator</option>
                            </select>
                        </div>

                        <div class="flex justify-end gap-3 pt-6">
                            <button type="button" @click="closeUserModal()"
                                class="px-8 py-5 text-[11px] font-bold uppercase tracking-widest text-gray-400 hover:text-gray-900 transition-colors">Cancel</button>
                            <button type="submit" :disabled="saving"
                                class="px-10 py-5 bg-gray-900 text-white rounded-[22px] text-[11px] font-bold uppercase tracking-[0.2em] shadow-xl shadow-gray-200 hover:bg-black active:scale-95 transition-all">
                                <span x-text="saving ? 'Saving...' : 'Save User'"></span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/js/pages/settings.js"></script>